<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Upload do podstrony</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    #dropzone {
      border: 2px dashed #888;
      padding: 2rem;
      text-align: center;
      margin-top: 1rem;
      border-radius: 10px;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>Upload plików do podstrony</h1>
  <input type="text" id="page-input" placeholder="Wpisz nazwę podstrony" />
  <div id="dropzone">Przeciągnij pliki tutaj</div>
  <p>Po wrzuceniu plików idź na <code>podstrona.html?page=nazwaPodstrony</code>, aby je zobaczyć.</p>
    <button id="login-button">Zaloguj się przez GitHub</button>

  <script>
  let db;

    function getPageFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("page") || "default";
    }

    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open("FileDatabase", 1);
        request.onerror = () => reject("IndexedDB error");
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = e => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains("files")) {
            db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
          }
        };
      });
    }

    function loadFiles(page) {
      document.getElementById("page-name").textContent = page;
      const tx = db.transaction("files", "readonly");
      const store = tx.objectStore("files");
      const filesContainer = document.getElementById("files");
      filesContainer.innerHTML = "";

      const cursor = store.openCursor();
      cursor.onsuccess = function(e) {
        const result = e.target.result;
        if (result) {
          const file = result.value;
          if (file.page === page) {
            const div = document.createElement("div");
            div.className = "file";
            div.innerHTML = `<strong>${file.name}</strong>`;
            if (file.type.startsWith("image/")) {
              const img = document.createElement("img");
              img.src = URL.createObjectURL(file.blob);
              img.className = "preview";
              div.appendChild(img);
            }
            filesContainer.appendChild(div);
          }
          result.continue();
        }
      };
    }

    openDB().then(database => {
      db = database;
      const page = getPageFromQuery();
      loadFiles(page);
    });
   
  </script>
</body>
</html>
